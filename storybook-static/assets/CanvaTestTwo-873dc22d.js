import{j as x}from"./jsx-runtime-ffb262ed.js";import{r as d}from"./index-76fb7be0.js";import{u as xe}from"./useTranslation-00555890.js";function ve(o,s,i,c,u,f,b){try{var S=o[f](b),l=S.value}catch(C){i(C);return}S.done?s(l):Promise.resolve(l).then(c,u)}function Pe(o){return function(){var s=this,i=arguments;return new Promise(function(c,u){var f=o.apply(s,i);function b(l){ve(f,c,u,b,S,"next",l)}function S(l){ve(f,c,u,b,S,"throw",l)}b(void 0)})}}function ae(){return ae=Object.assign||function(o){for(var s=1;s<arguments.length;s++){var i=arguments[s];for(var c in i)Object.prototype.hasOwnProperty.call(i,c)&&(o[c]=i[c])}return o},ae.apply(this,arguments)}var ye={exports:{}};(function(o){var s=function(i){var c=Object.prototype,u=c.hasOwnProperty,f,b=typeof Symbol=="function"?Symbol:{},S=b.iterator||"@@iterator",l=b.asyncIterator||"@@asyncIterator",C=b.toStringTag||"@@toStringTag";function y(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{y({},"")}catch{y=function(e,n,a){return e[n]=a}}function M(t,e,n,a){var r=e&&e.prototype instanceof A?e:A,h=Object.create(r.prototype),m=new re(a||[]);return h._invoke=oe(t,n,m),h}i.wrap=M;function U(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(a){return{type:"throw",arg:a}}}var j="suspendedStart",B="suspendedYield",D="executing",W="completed",T={};function A(){}function H(){}function R(){}var F={};y(F,S,function(){return this});var J=Object.getPrototypeOf,X=J&&J(J(Q([])));X&&X!==c&&u.call(X,S)&&(F=X);var $=R.prototype=A.prototype=Object.create(F);H.prototype=R,y($,"constructor",R),y(R,"constructor",H),H.displayName=y(R,C,"GeneratorFunction");function ee(t){["next","throw","return"].forEach(function(e){y(t,e,function(n){return this._invoke(e,n)})})}i.isGeneratorFunction=function(t){var e=typeof t=="function"&&t.constructor;return e?e===H||(e.displayName||e.name)==="GeneratorFunction":!1},i.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,R):(t.__proto__=R,y(t,C,"GeneratorFunction")),t.prototype=Object.create($),t},i.awrap=function(t){return{__await:t}};function q(t,e){function n(h,m,p,k){var g=U(t[h],t,m);if(g.type==="throw")k(g.arg);else{var I=g.arg,P=I.value;return P&&typeof P=="object"&&u.call(P,"__await")?e.resolve(P.__await).then(function(N){n("next",N,p,k)},function(N){n("throw",N,p,k)}):e.resolve(P).then(function(N){I.value=N,p(I)},function(N){return n("throw",N,p,k)})}}var a;function r(h,m){function p(){return new e(function(k,g){n(h,m,k,g)})}return a=a?a.then(p,p):p()}this._invoke=r}ee(q.prototype),y(q.prototype,l,function(){return this}),i.AsyncIterator=q,i.async=function(t,e,n,a,r){r===void 0&&(r=Promise);var h=new q(M(t,e,n,a),r);return i.isGeneratorFunction(e)?h:h.next().then(function(m){return m.done?m.value:h.next()})};function oe(t,e,n){var a=j;return function(h,m){if(a===D)throw new Error("Generator is already running");if(a===W){if(h==="throw")throw m;return z()}for(n.method=h,n.arg=m;;){var p=n.delegate;if(p){var k=te(p,n);if(k){if(k===T)continue;return k}}if(n.method==="next")n.sent=n._sent=n.arg;else if(n.method==="throw"){if(a===j)throw a=W,n.arg;n.dispatchException(n.arg)}else n.method==="return"&&n.abrupt("return",n.arg);a=D;var g=U(t,e,n);if(g.type==="normal"){if(a=n.done?W:B,g.arg===T)continue;return{value:g.arg,done:n.done}}else g.type==="throw"&&(a=W,n.method="throw",n.arg=g.arg)}}}function te(t,e){var n=t.iterator[e.method];if(n===f){if(e.delegate=null,e.method==="throw"){if(t.iterator.return&&(e.method="return",e.arg=f,te(t,e),e.method==="throw"))return T;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return T}var a=U(n,t.iterator,e.arg);if(a.type==="throw")return e.method="throw",e.arg=a.arg,e.delegate=null,T;var r=a.arg;if(!r)return e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,T;if(r.done)e[t.resultName]=r.value,e.next=t.nextLoc,e.method!=="return"&&(e.method="next",e.arg=f);else return r;return e.delegate=null,T}ee($),y($,C,"Generator"),y($,S,function(){return this}),y($,"toString",function(){return"[object Generator]"});function K(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function V(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function re(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(K,this),this.reset(!0)}i.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function a(){for(;e.length;){var r=e.pop();if(r in t)return a.value=r,a.done=!1,a}return a.done=!0,a}};function Q(t){if(t){var e=t[S];if(e)return e.call(t);if(typeof t.next=="function")return t;if(!isNaN(t.length)){var n=-1,a=function r(){for(;++n<t.length;)if(u.call(t,n))return r.value=t[n],r.done=!1,r;return r.value=f,r.done=!0,r};return a.next=a}}return{next:z}}i.values=Q;function z(){return{value:f,done:!0}}return re.prototype={constructor:re,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=f,this.done=!1,this.delegate=null,this.method="next",this.arg=f,this.tryEntries.forEach(V),!t)for(var e in this)e.charAt(0)==="t"&&u.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=f)},stop:function(){this.done=!0;var t=this.tryEntries[0],e=t.completion;if(e.type==="throw")throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(k,g){return h.type="throw",h.arg=t,e.next=k,g&&(e.method="next",e.arg=f),!!g}for(var a=this.tryEntries.length-1;a>=0;--a){var r=this.tryEntries[a],h=r.completion;if(r.tryLoc==="root")return n("end");if(r.tryLoc<=this.prev){var m=u.call(r,"catchLoc"),p=u.call(r,"finallyLoc");if(m&&p){if(this.prev<r.catchLoc)return n(r.catchLoc,!0);if(this.prev<r.finallyLoc)return n(r.finallyLoc)}else if(m){if(this.prev<r.catchLoc)return n(r.catchLoc,!0)}else if(p){if(this.prev<r.finallyLoc)return n(r.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&u.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var r=a;break}}r&&(t==="break"||t==="continue")&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var h=r?r.completion:{};return h.type=t,h.arg=e,r?(this.method="next",this.next=r.finallyLoc,T):this.complete(h)},complete:function(t,e){if(t.type==="throw")throw t.arg;return t.type==="break"||t.type==="continue"?this.next=t.arg:t.type==="return"?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):t.type==="normal"&&e&&(this.next=e),T},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),V(n),T}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var a=n.completion;if(a.type==="throw"){var r=a.arg;V(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:Q(t),resultName:e,nextLoc:n},this.method==="next"&&(this.arg=f),T}},i}(o.exports);try{regeneratorRuntime=s}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=s:Function("r","regeneratorRuntime = r")(s)}})(ye);var pe=ye.exports,ke=function(s){var i=s.paths,c=s.id,u=s.strokeWidth,f=s.strokeColor,b=s.command,S=b===void 0?_e:b;if(i.length===1){var l=i[0],C=l.x,y=l.y,M=u/2;return d.createElement("circle",{key:c,id:c,cx:C,cy:y,r:M,stroke:f,fill:f})}var U=i.reduce(function(j,B,D,W){return D===0?"M "+B.x+","+B.y:j+" "+S(B,D,W)},"");return d.createElement("path",{key:c,id:c,d:U,fill:"none",strokeLinecap:"round",stroke:f,strokeWidth:u})},Ee=function(s,i){var c=i.x-s.x,u=i.y-s.y;return{length:Math.sqrt(Math.pow(c,2)+Math.pow(u,2)),angle:Math.atan2(u,c)}},he=function(s){var i=s.current,c=s.next,u=s.previous,f=s.reverse,b=u||i,S=c||i,l=.2,C=Ee(b,S),y=C.angle+(f?Math.PI:0),M=C.length*l,U=i.x+Math.cos(y)*M,j=i.y+Math.sin(y)*M;return[U,j]},_e=function(s,i,c){var u=null,f=null;switch(i){case 0:var b=he({current:s});u=b[0],f=b[1];break;case 1:var S=he({current:c[i-1],next:s});u=S[0],f=S[1];break;default:var l=he({current:c[i-1],previous:c[i-2],next:s});u=l[0],f=l[1];break}var C=he({current:s,previous:c[i-1],next:c[i+1],reverse:!0}),y=C[0],M=C[1];return"C "+u+","+f+" "+y+","+M+" "+s.x+", "+s.y},Ce=function(s){var i=s.id,c=s.paths;return d.createElement(d.Fragment,null,c.map(function(u,f){return d.createElement(ke,{key:i+"__"+f,paths:u.paths,id:i+"__"+f,strokeWidth:u.strokeWidth,strokeColor:u.strokeColor,command:_e})}))},me=function(s){return new Promise(function(i,c){var u=new Image;u.addEventListener("load",function(){u.width>0&&i(u),c("Image not found")}),u.addEventListener("error",function(f){return c(f)}),u.src=s,u.setAttribute("crossorigin","anonymous")})};function ge(o){var s,i=(s=o.firstChild)==null?void 0:s.cloneNode(!0),c=o.offsetWidth,u=o.offsetHeight;return i.setAttribute("viewBox","0 0 "+c+" "+u),i.setAttribute("width",c.toString()),i.setAttribute("height",u.toString()),{svgCanvas:i,width:c,height:u}}var Te=d.forwardRef(function(o,s){var i=o.paths,c=o.isDrawing,u=o.onPointerDown,f=o.onPointerMove,b=o.onPointerUp,S=o.id,l=S===void 0?"react-sketch-canvas":S,C=o.width,y=C===void 0?"100%":C,M=o.height,U=M===void 0?"100%":M,j=o.className,B=j===void 0?"react-sketch-canvas":j,D=o.canvasColor,W=D===void 0?"red":D,T=o.backgroundImage,A=T===void 0?"":T,H=o.exportWithBackgroundImage,R=H===void 0?!1:H,F=o.preserveBackgroundImageAspectRatio,J=F===void 0?"none":F,X=o.allowOnlyPointerType,$=X===void 0?"all":X,ee=o.style,q=ee===void 0?{border:"0.0625rem solid #9c9c9c",borderRadius:"0.25rem"}:ee,oe=o.svgStyle,te=oe===void 0?{}:oe,K=d.useRef(null),V=function(r){var h,m,p,k=(h=K.current)==null?void 0:h.getBoundingClientRect(),g=(m=window.scrollX)!=null?m:0,I=(p=window.scrollY)!=null?p:0;if(!k)return{x:0,y:0};var P={x:r.pageX-k.left-g,y:r.pageY-k.top-I};return P},re=function(r){if(!($!=="all"&&r.pointerType!==$)&&!(r.pointerType==="mouse"&&r.button!==0)){var h=V(r);u(h)}},Q=function(r){if(c&&!($!=="all"&&r.pointerType!==$)){var h=V(r);f(h)}},z=function(r){r.pointerType==="mouse"&&r.button!==0||$!=="all"&&r.pointerType!==$||b()};d.useImperativeHandle(s,function(){return{exportImage:function(r){return new Promise(function(){var h=Pe(pe.mark(function m(p,k){var g,I,P,N,ue,ne,ie,O;return pe.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(_.prev=0,g=K.current,g){_.next=4;break}throw Error("Canvas not rendered yet");case 4:return I=ge(g),P=I.svgCanvas,N=I.width,ue=I.height,ne="data:image/svg+xml;base64,"+btoa(P.outerHTML),_.next=8,me(ne);case 8:if(_.t0=_.sent,ie=[_.t0],!R){_.next=21;break}return _.prev=11,_.next=14,me(A);case 14:O=_.sent,ie.push(O),_.next=21;break;case 18:_.prev=18,_.t1=_.catch(11),console.warn("exportWithBackgroundImage props is set without a valid background image URL. This option is ignored");case 21:Promise.all(ie).then(function(ce){var se=document.createElement("canvas");se.setAttribute("width",N.toString()),se.setAttribute("height",ue.toString());var le=se.getContext("2d");if(!le)throw Error("Canvas not rendered yet");ce.reverse().forEach(function(E){le.drawImage(E,0,0)}),p(se.toDataURL("image/"+r))}).catch(function(ce){throw ce}),_.next=27;break;case 24:_.prev=24,_.t2=_.catch(0),k(_.t2);case 27:case"end":return _.stop()}},m,null,[[0,24],[11,18]])}));return function(m,p){return h.apply(this,arguments)}}())},exportSvg:function(){return new Promise(function(r,h){try{var m,p=(m=K.current)!=null?m:null;if(p!==null){var k,g,I=ge(p),P=I.svgCanvas;if(R){r(P.outerHTML);return}(k=P.querySelector("#"+l+"__background"))==null||k.remove(),(g=P.querySelector("#"+l+"__canvas-background"))==null||g.setAttribute("fill",W),r(P.outerHTML)}h(new Error("Canvas not loaded"))}catch(N){h(N)}})}}}),d.useEffect(function(){return document.addEventListener("pointerup",z),function(){document.removeEventListener("pointerup",z)}},[z]);var t=i.filter(function(a){return!a.drawMode}),e=0,n=i.reduce(function(a,r){return r.drawMode?(a[e]===void 0&&(a[e]=[]),a[e].push(r),a):(e+=1,a)},[[]]);return d.createElement("div",{role:"presentation",ref:K,className:B,style:ae({touchAction:"none",width:y,height:U},q),"touch-action":"none",onPointerDown:re,onPointerMove:Q,onPointerUp:z},d.createElement("svg",{version:"1.1",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",style:ae({width:"100%",height:"100%"},te),id:l},d.createElement("g",{id:l+"__eraser-stroke-group",display:"none"},d.createElement("rect",{id:l+"__mask-background",x:"0",y:"0",width:"100%",height:"100%",fill:"white"}),t.map(function(a,r){return d.createElement(ke,{key:l+"__eraser-"+r,id:l+"__eraser-"+r,paths:a.paths,strokeColor:"#000000",strokeWidth:a.strokeWidth})})),d.createElement("defs",null,A&&d.createElement("pattern",{id:l+"__background",x:"0",y:"0",width:"100%",height:"100%",patternUnits:"userSpaceOnUse"},d.createElement("image",{x:"0",y:"0",width:"100%",height:"100%",xlinkHref:A,preserveAspectRatio:J})),t.map(function(a,r){return d.createElement("mask",{id:l+"__eraser-mask-"+r,key:l+"__eraser-mask-"+r,maskUnits:"userSpaceOnUse"},d.createElement("use",{href:"#"+l+"__mask-background"}),Array.from({length:t.length-r},function(h,m){return m+r}).map(function(h){return d.createElement("use",{key:h.toString(),href:"#"+l+"__eraser-"+h.toString()})}))})),d.createElement("g",{id:l+"__canvas-background-group"},d.createElement("rect",{id:l+"__canvas-background",x:"0",y:"0",width:"100%",height:"100%",fill:A?"url(#"+l+"__background)":W})),n.map(function(a,r){return d.createElement("g",{id:l+"__stroke-group-"+r,key:l+"__stroke-group-"+r,mask:"url(#"+l+"__eraser-mask-"+r+")"},d.createElement(Ce,{id:l,paths:a}))})))}),$e=d.forwardRef(function(o,s){var i=o.id,c=i===void 0?"react-sketch-canvas":i,u=o.width,f=u===void 0?"100%":u,b=o.height,S=b===void 0?"100%":b,l=o.className,C=l===void 0?"":l,y=o.canvasColor,M=y===void 0?"white":y,U=o.strokeColor,j=U===void 0?"red":U,B=o.backgroundImage,D=B===void 0?"":B,W=o.exportWithBackgroundImage,T=W===void 0?!1:W,A=o.preserveBackgroundImageAspectRatio,H=A===void 0?"none":A,R=o.strokeWidth,F=R===void 0?4:R,J=o.eraserWidth,X=J===void 0?8:J,$=o.allowOnlyPointerType,ee=$===void 0?"all":$,q=o.style,oe=q===void 0?{border:"0.0625rem solid #9c9c9c",borderRadius:"0.25rem"}:q,te=o.svgStyle,K=te===void 0?{}:te,V=o.onChange,re=V===void 0?function(E){}:V,Q=o.onStroke,z=Q===void 0?function(E,v){}:Q,t=o.withTimestamp,e=t===void 0?!1:t,n=d.createRef(),a=d.useState(!0),r=a[0],h=a[1],m=d.useState(!1),p=m[0],k=m[1],g=d.useState([]),I=g[0],P=g[1],N=d.useState([]),ue=N[0],ne=N[1],ie=d.useState([]),O=ie[0],G=ie[1],_=d.useCallback(function(){var E,v,w=(E=(v=O.slice(-1))==null?void 0:v[0])!=null?E:null;if(w===null){console.warn("No stroke found!");return}z(w,!w.drawMode)},[p]);d.useEffect(function(){_()},[p]),d.useEffect(function(){re(O)},[O]),d.useImperativeHandle(s,function(){return{eraseMode:function(v){h(!v)},clearCanvas:function(){P([].concat(O)),G([])},undo:function(){if(I.length!==0){G([].concat(I)),P([]);return}ne(function(v){return[].concat(v,O.slice(-1))}),G(function(v){return v.slice(0,-1)})},redo:function(){ue.length!==0&&(G(function(v){return[].concat(v,ue.slice(-1))}),ne(function(v){return v.slice(0,-1)}))},exportImage:function(v){var w,L=(w=n.current)==null?void 0:w.exportImage;if(L)return L(v);throw Error("Export function called before canvas loaded")},exportSvg:function(){return new Promise(function(v,w){var L,Y=(L=n.current)==null?void 0:L.exportSvg;Y?Y().then(function(Z){v(Z)}).catch(function(Z){w(Z)}):w(Error("Export function called before canvas loaded"))})},exportPaths:function(){return new Promise(function(v,w){try{v(O)}catch(L){w(L)}})},loadPaths:function(v){G(function(w){return[].concat(w,v)})},getSketchingTime:function(){return new Promise(function(v,w){e||w(new Error("Set 'withTimestamp' prop to get sketching time"));try{var L=O.reduce(function(Y,Z){var de,fe,be=(de=Z.startTimestamp)!=null?de:0,Se=(fe=Z.endTimestamp)!=null?fe:0;return Y+(Se-be)},0);v(L)}catch(Y){w(Y)}})},resetCanvas:function(){P([]),ne([]),G([])}}});var ce=function(v){k(!0),ne([]);var w={drawMode:r,strokeColor:r?j:"#000000",strokeWidth:r?F:X,paths:[v]};e&&(w=ae({},w,{startTimestamp:Date.now(),endTimestamp:0})),G(function(L){return[].concat(L,[w])})},se=function(v){if(p){var w=O.slice(-1)[0],L=ae({},w,{paths:[].concat(w.paths,[v])});G(function(Y){return[].concat(Y.slice(0,-1),[L])})}},le=function(){var v,w;if(p&&(k(!1),!!e)){var L=(v=(w=O.slice(-1))==null?void 0:w[0])!=null?v:null;if(L!==null){var Y=ae({},L,{endTimestamp:Date.now()});G(function(Z){return[].concat(Z.slice(0,-1),[Y])})}}};return d.createElement(Te,{ref:n,id:c,width:f,height:S,className:C,canvasColor:M,backgroundImage:D,exportWithBackgroundImage:T,preserveBackgroundImageAspectRatio:H,allowOnlyPointerType:ee,style:oe,svgStyle:K,paths:O,isDrawing:p,onPointerDown:ce,onPointerMove:se,onPointerUp:le})});const Le=""+new URL("clear-22eda243.svg",import.meta.url).href,Ie=""+new URL("eraser-984247b0.svg",import.meta.url).href,Ne=""+new URL("pencil-50e3e3ff.svg",import.meta.url).href,Me=""+new URL("redo-4e586ecb.svg",import.meta.url).href,Re=""+new URL("undo-31b4cabf.svg",import.meta.url).href,we=({canvasRef:o,content:s})=>{const{t:i}=xe(),c={border:"1.2px solid #E5E5E5",width:"85vw",height:"50vh"};return d.useEffect(()=>{o&&s&&o.current.loadPaths(JSON.parse(s))},[o,s]),x.jsxs(x.Fragment,{children:[x.jsx("div",{className:"flex justify-between px-2 py-2",children:x.jsxs("div",{className:"",children:[x.jsxs("button",{onClick:()=>{o.current.undo()},className:"outline-none focus:outline-none",children:[x.jsx("img",{src:Re,alt:"Undo icon",className:"w-5 inline-block"}),x.jsx("span",{className:"inline-block text-xs"})]}),x.jsxs("button",{onClick:()=>{o.current.redo()},className:"px-1 sm:px-3 outline-none focus:outline-none border-r border-gray",children:[x.jsx("img",{src:Me,alt:"Undo icon",className:"w-5 inline-block"}),x.jsx("span",{className:"inline-block text-xs"})]}),x.jsxs("button",{onClick:()=>{o.current.eraseMode(!0)},className:"pl-3 outline-none focus:outline-none",children:[x.jsx("img",{src:Ie,alt:"Undo icon",className:"w-5 inline-block"}),x.jsx("span",{className:"inline-block text-xs",children:i("erase")})]}),x.jsxs("button",{onClick:()=>{o.current.eraseMode(!1)},className:"px-3 outline-none focus:outline-none border-r border-gray",children:[x.jsx("img",{src:Ne,alt:"Undo icon",className:"w-5 inline-block"}),x.jsx("span",{className:"inline-block text-xs",children:i("write")})]}),x.jsxs("button",{onClick:()=>{o.current.clearCanvas()},className:"pl-3 outline-none focus:outline-none",children:[x.jsx("img",{src:Le,alt:"Undo icon",className:"w-5 inline-block"}),x.jsx("span",{className:"inline-block text-xs",children:i("clear")})]})]})}),x.jsx($e,{ref:o,style:c,strokeWidth:1,strokeColor:"black"})]})};try{we.displayName="CanvaTestTwo",we.__docgenInfo={description:"",displayName:"CanvaTestTwo",props:{canvasRef:{defaultValue:null,description:"",name:"canvasRef",required:!0,type:{name:"any"}},content:{defaultValue:null,description:"",name:"content",required:!0,type:{name:"any"}}}}}catch{}export{we as C};
